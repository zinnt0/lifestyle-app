# Lifestyle App - Fitness & Nutrition Tracker

## Projekt-√úbersicht

React Native (Expo) App f√ºr Training, Ern√§hrung und Supplements.
Zielgruppe: Fitness-Enthusiasten, wissenschaftlich fundiert.

## Tech Stack

- **Frontend**: React Native + Expo (TypeScript)
- **Backend**: Supabase (PostgreSQL + Auth)
- **Navigation**: React Navigation
- **State**: React Hooks (kein Redux)
- **Styling**: React Native StyleSheet (kein Tailwind/NativeWind)

## Projekt-Struktur

```
src/
‚îú‚îÄ‚îÄ lib/              # Third-party library configs
‚îÇ   ‚îî‚îÄ‚îÄ supabase.ts   # ‚úÖ Supabase client mit AsyncStorage
‚îú‚îÄ‚îÄ services/         # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts     # ‚úÖ Authentication service
‚îÇ   ‚îî‚îÄ‚îÄ profile.service.ts  # ‚úÖ Profile & onboarding service
‚îú‚îÄ‚îÄ contexts/         # React Context providers
‚îÇ   ‚îî‚îÄ‚îÄ OnboardingContext.tsx  # ‚úÖ 6-step onboarding state
‚îú‚îÄ‚îÄ utils/            # Utilities
‚îÇ   ‚îî‚îÄ‚îÄ validation.ts    # ‚úÖ Form validation functions
‚îú‚îÄ‚îÄ hooks/            # Custom React hooks
‚îÇ   ‚îî‚îÄ‚îÄ useForm.ts       # ‚úÖ Form state management
‚îú‚îÄ‚îÄ screens/          # Screen components
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/   # ‚úÖ 6 Onboarding Screens + Summary (2025-12-26)
‚îÇ   ‚îú‚îÄ‚îÄ app/          # ‚úÖ Main app screens (2025-12-27)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomeScreen.tsx        # ‚úÖ Dashboard/Landing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileScreen.tsx     # ‚úÖ Profile display with Edit button
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileEditScreen.tsx # ‚úÖ Profile edit form (2025-12-27)
‚îÇ   ‚îú‚îÄ‚îÄ auth/         # ‚è∏Ô∏è Login, Register
‚îÇ   ‚îú‚îÄ‚îÄ training/     # ‚è∏Ô∏è Training screens
‚îÇ   ‚îî‚îÄ‚îÄ nutrition/    # ‚è∏Ô∏è Nutrition screens
‚îú‚îÄ‚îÄ components/       # Reusable UI components
‚îÇ   ‚îî‚îÄ‚îÄ ui/           # ‚úÖ 13 UI Components (2025-12-26)
‚îú‚îÄ‚îÄ types/            # ‚è∏Ô∏è TypeScript types
‚îú‚îÄ‚îÄ tests/            # Test files
‚îÇ   ‚îú‚îÄ‚îÄ auth.test.simple.ts   # ‚úÖ Auth tests
‚îÇ   ‚îî‚îÄ‚îÄ validation.test.ts    # ‚úÖ Validation tests (59 tests)
‚îî‚îÄ‚îÄ navigation/       # ‚úÖ Complete navigation system (2025-12-26)
    ‚îú‚îÄ‚îÄ AppNavigator.tsx          # ‚úÖ Root navigator (Auth/Onboarding/Main routing)
    ‚îú‚îÄ‚îÄ OnboardingNavigator.tsx   # ‚úÖ Onboarding flow coordinator
    ‚îú‚îÄ‚îÄ MainNavigator.tsx         # ‚úÖ Main app navigation (Home/Profile)
    ‚îú‚îÄ‚îÄ AuthNavigator.tsx         # ‚è∏Ô∏è Auth flow (Login/Register)
    ‚îú‚îÄ‚îÄ types.ts                  # ‚úÖ Navigation type definitions
    ‚îî‚îÄ‚îÄ index.ts                  # ‚úÖ Navigation exports
```

## Supabase Schema

**18 Tabellen, alle erstellt:**

- Core: profiles, exercises (6 rows), intolerances_catalog (8 rows)
- Training: training_plans, plan_workouts, plan_exercises, workout_sessions, workout_sets, user_1rm
- Nutrition: nutrition_goals, meal_plans, meals, meal_items, food_items, daily_nutrition_log
- Supplements: supplements, user_supplements

**RLS aktiviert** auf allen User-Tabellen.

## Wichtige Dateien

- `.env`: EXPO_PUBLIC_SUPABASE_URL, EXPO_PUBLIC_SUPABASE_ANON_KEY
- `src/lib/supabase.ts`: Supabase client setup (‚úÖ implementiert mit AsyncStorage)
- `src/services/auth.service.ts`: Auth logic (‚úÖ komplett mit 7 Funktionen)
- `src/services/profile.service.ts`: Profile & onboarding logic (‚úÖ komplett mit 8 Funktionen)
- `src/contexts/OnboardingContext.tsx`: 6-step onboarding state management (‚úÖ implementiert)
- `src/utils/validation.ts`: Form validation utilities (‚úÖ implementiert)
- `src/hooks/useForm.ts`: Custom form hook (‚úÖ implementiert)
- `src/components/ui/`: 13 UI Components (‚úÖ implementiert 2025-12-26)
- `src/screens/onboarding/`: 6 Onboarding Screens + Summary (‚úÖ implementiert 2025-12-26)
- `src/screens/app/`: Main app screens (‚úÖ implementiert 2025-12-27)
  - `HomeScreen.tsx`: Dashboard/Landing
  - `ProfileScreen.tsx`: Profile display with Edit button + useFocusEffect refresh
  - `ProfileEditScreen.tsx`: Comprehensive profile edit form (‚úÖ implementiert 2025-12-27)
- `src/navigation/`: Complete navigation system (‚úÖ implementiert 2025-12-26, updated 2025-12-27)
  - `AppNavigator.tsx`: Root navigator with auth/onboarding/main flow routing
  - `OnboardingNavigator.tsx`: Onboarding flow manager
  - `MainNavigator.tsx`: Main app stack navigator (includes ProfileEdit route)
  - `types.ts`: TypeScript navigation parameter lists (includes ProfileEdit)

## Implementierte Features (Stand: 2025-12-27)

### 1. Authentication System (‚úÖ Komplett)

**Dateien**: `src/lib/supabase.ts`, `src/services/auth.service.ts`

**Funktionen**:
- `signUp(email, password)` - Registrierung mit deutscher Fehlerbehandlung
- `signIn(email, password)` - Login
- `signOut()` - Logout
- `getCurrentUser()` - Aktueller User
- `onAuthStateChange(callback)` - Auth state listener
- `resetPassword(email)` - Passwort zur√ºcksetzen
- `updatePassword(newPassword)` - Passwort √§ndern

**Features**:
- AsyncStorage persistence f√ºr Sessions
- Alle Fehler in Deutsch
- TypeScript strict mode
- Response format: `{ user: User | null, error: string | null }`

**Tests**: `src/tests/auth.test.simple.ts` - Run mit `npm run test:auth:simple`

### 2. Form Validation System (‚úÖ Komplett)

**Dateien**: `src/utils/validation.ts`, `src/hooks/useForm.ts`

**Validators**:
- `validateEmail()` - Email-Format pr√ºfen
- `validatePassword()` - Min 8 Zeichen, Gro√ü-/Kleinbuchstaben, Zahl
- `validateName()` - Namen validieren
- `validateAge()` - Alter 13-120 Jahre
- `validateRegistrationForm()` - Komplette Registrierung
- `validateLoginForm()` - Login-Form

**useForm Hook**:
```typescript
const { values, errors, isSubmitting, handleChange, handleSubmit, reset } = useForm({
  initialValues: { email: '', password: '' },
  validate: validateLoginForm,
  onSubmit: async (values) => { /* logic */ }
});
```

**Tests**: 59 Unit Tests in `src/tests/validation.test.ts` - Run mit `npm run test:validation`

**Design-Entscheidung**: Keine externe Validation Library (Zod/Yup) f√ºr kleineren Bundle

### 3. UI Components (‚úÖ Komplett - 2025-12-26)

**Location**: `src/components/ui/`

**Basis Components** (urspr√ºnglich):
- `Button.tsx` - Variants: primary, secondary, outline
- `Card.tsx` - Container component
- `Input.tsx` - Text input mit error state
- `Text.tsx` - Typography mit size variants

**Neue Components** (2025-12-26):
- `ProgressBar.tsx` - Progress Indicator (0-100% mit animated fill)
- `RadioGroup.tsx` - Radio Button Group mit Vertical/Horizontal Layout
- `NumberPicker.tsx` - +/- Number Selector mit Min/Max bounds
- `MultiSelectChips.tsx` - Multi-Select Chips mit horizontal scrollbar
- `GoalCard.tsx` - Large Goal Selection Card mit Icon & Checkmark
- `Slider.tsx` - React Native Slider Wrapper mit Labels & Value Formatter
- `index.tsx` - Central export f√ºr alle UI Components

**Design System**:
- Consistent `COLORS` object (primary, secondary, text, border, error, success)
- `SPACING` constants (xs: 4, sm: 8, md: 16, lg: 24, xl: 32)
- `FONT_SIZES` (sm: 12, md: 14, lg: 16, xl: 18, xxl: 24)
- Style composition via `style` prop override

**Features**:
- TypeScript strict mode mit vollst√§ndigen Interfaces
- Accessibility support (accessibilityLabel, accessibilityRole)
- Error states & validation feedback
- Loading states wo relevant
- Disabled states mit visueller R√ºckmeldung
- Native Performance (keine Web-Dependencies)

### 4. Profile Service (‚úÖ Komplett) - **NEU 2025-12-26**

**Datei**: `src/services/profile.service.ts`

**Zweck**: Service Layer f√ºr Profile-Management und Onboarding-Daten

**Funktionen**:
- `createProfile(data)` - Erstellt/aktualisiert Profil mit Onboarding-Daten
- `getProfile(userId)` - L√§dt User-Profil mit Intolerances
- `updateProfile(userId, updates)` - Aktualisiert spezifische Profil-Felder
- `getIntolerancesCatalog()` - L√§dt Intolerances Katalog aus DB
- `saveUserIntolerances(userId, intoleranceIds)` - Speichert User Intolerances
- `getUserIntolerances(userId)` - Holt User Intolerances mit Details
- `isOnboardingCompleted(userId)` - Pr√ºft Onboarding-Status
- `getProfileCompleteness(userId)` - Berechnet Profil-Vollst√§ndigkeit (0-100%)

**Features**:
- Deutsche Fehlermeldungen mit automatischem Error-Mapping
- TypeScript strict typing
- Service Layer Pattern (Trennung von UI und Business Logic)
- Integration mit Supabase (profiles + user_intolerances tables)
- Wiederverwendbare Funktionen f√ºr verschiedene Screens

**Beispiel-Verwendung**:
```typescript
import { createProfile, getProfile } from '@/services/profile.service';

// Profil erstellen nach Onboarding
const result = await createProfile({
  gender: 'male',
  age: 28,
  height: 180,
  weight: 75,
  goal: 'muscle_gain',
  intolerances: ['lactose', 'gluten']
});

// Profil laden
const profile = await getProfile(userId);
```

**Response Format**: `{ data: T | null, error: string | null }`

### 5. Onboarding Screens (‚úÖ Komplett - 2025-12-26)

**Location**: `src/screens/onboarding/`

**6 Onboarding Screens**:

1. **OnboardingScreen1.tsx** - Basisdaten
   - Age (NumberPicker: 13-120)
   - Weight (NumberPicker: 40-200 kg)
   - Height (NumberPicker: 140-220 cm)
   - Gender (RadioGroup: Male/Female/Diverse)

2. **OnboardingScreen2.tsx** - Trainingserfahrung
   - Training Level (RadioGroup: Beginner/Intermediate/Advanced/Elite)
   - Years of Experience (NumberPicker: 0-50)
   - Days per Week (NumberPicker: 1-7)
   - Equipment Access (RadioGroup: Gym/Home/Both/Bodyweight)

3. **OnboardingScreen3.tsx** - Fitnessziele
   - Goal Selection (5 GoalCards):
     - üí™ Kraft aufbauen
     - üèãÔ∏è Muskelaufbau
     - üî• Gewicht verlieren
     - üèÉ Ausdauer steigern
     - üåü Allgemeine Fitness
   - Single-Select mit Icon & Checkmark

4. **OnboardingScreen4.tsx** - Lifestyle
   - Sleep Hours per Night (Slider: 4-12h mit 0.5h steps)
   - Stress Level (Slider: 1-10)

5. **OnboardingScreen5.tsx** - Unvertr√§glichkeiten
   - L√§dt Katalog aus Supabase (`intolerances_catalog`)
   - MultiSelectChips f√ºr Selection
   - Optional (Skip m√∂glich)
   - Error Handling mit Retry-Button

6. **OnboardingSummary.tsx** - Zusammenfassung & Submit
   - Zeigt alle Eingaben in Kategorien
   - "Bearbeiten" Links zu jedem Screen via `goToStep()`
   - Submit Button ‚Üí `submitOnboarding()` ‚Üí Supabase

**Gemeinsame Features**:
- ‚úÖ Integration mit `OnboardingContext` via `useOnboarding()` hook
- ‚úÖ Automatische Validierung vor `nextStep()`
- ‚úÖ ProgressBar in jedem Screen (currentStep / totalSteps * 100)
- ‚úÖ KeyboardAvoidingView f√ºr iOS/Android Keyboard-Handling
- ‚úÖ ScrollView f√ºr alle Inhalte (responsive auf kleinen Screens)
- ‚úÖ Deutsche Fehlermeldungen
- ‚úÖ Loading States (Screen 5 beim Laden, Summary beim Submit)
- ‚úÖ Error Handling mit User-Feedback
- ‚úÖ Navigation: `nextStep()`, `previousStep()`, `goToStep(n)`

**Supabase Integration**:
- Screen 5: `getIntolerancesCatalog()` l√§dt Optionen
- Summary: `submitOnboarding()` ‚Üí `createProfile()` ‚Üí Profil in DB

**Export Structure**:
```typescript
// src/screens/onboarding/index.tsx
export { default as OnboardingScreen1 } from './OnboardingScreen1';
export { default as OnboardingScreen2 } from './OnboardingScreen2';
// ... etc
```

**Usage Example**:
```typescript
import { OnboardingScreen1 } from '@/screens/onboarding';

<OnboardingProvider>
  <OnboardingScreen1 />
</OnboardingProvider>
```

**Dokumentation**: `src/screens/onboarding/README.md`

### 6. Onboarding Context (‚úÖ Komplett - 2025-12-26)

**Datei**: `src/contexts/OnboardingContext.tsx`

**Zweck**: Zentrale State-Management f√ºr 6-stufigen Onboarding-Flow

**Architektur**:
- React Context + useReducer Pattern
- 6 separate Screens mit eigener Validation
- Integration mit ProfileService
- Progress Tracking (0-100%)

**State Structure**:
```typescript
{
  currentScreen: number,           // 0-5
  data: {
    gender: string | null,
    age: number | null,
    height: number | null,
    weight: number | null,
    goal: string | null,
    intolerances: string[]
  },
  errors: Record<string, string>,  // Field-level errors
  isSubmitting: boolean
}
```

**Actions**:
- `UPDATE_FIELD` - Update einzelnes Feld
- `NEXT_SCREEN` - N√§chster Screen (mit Validation)
- `PREVIOUS_SCREEN` - Zur√ºck
- `SET_ERROR` - Fehler setzen
- `CLEAR_ERROR` - Fehler l√∂schen
- `SET_SUBMITTING` - Loading state
- `RESET` - Zur√ºcksetzen

**Provider Usage**:
```typescript
<OnboardingProvider>
  <OnboardingScreen />
</OnboardingProvider>
```

**Hook Usage**:
```typescript
const {
  state,
  updateField,
  nextScreen,
  previousScreen,
  submitOnboarding,
  progress
} = useOnboarding();

// Update field
updateField('age', 28);

// Navigate
await nextScreen(); // Validiert automatisch

// Submit
await submitOnboarding(); // Calls ProfileService
```

**Validation**:
- Screen-spezifische Validation vor Navigation
- Deutsche Fehlermeldungen
- Automatisches Error-Clearing bei Field-Update

**Integration mit ProfileService**:
```typescript
// In submitOnboarding()
const result = await createProfile({
  gender: state.data.gender!,
  age: state.data.age!,
  height: state.data.height!,
  weight: state.data.weight!,
  goal: state.data.goal!,
  intolerances: state.data.intolerances
});
```

### 6.1 Profile Edit System (‚úÖ Komplett - 2025-12-27)

**Location**: `src/screens/app/ProfileEditScreen.tsx`, `src/screens/app/ProfileScreen.tsx`

**Zweck**: Erm√∂glicht Usern, ihr Profil nach dem Onboarding zu bearbeiten

#### ProfileEditScreen

**Datei**: `src/screens/app/ProfileEditScreen.tsx`

**Architektur**:
- Comprehensive Single-Page Form mit 5 Sektionen
- ScrollView Layout mit KeyboardAvoidingView
- Integration mit ProfileService f√ºr CRUD Operations
- Reuse von Onboarding UI Components

**Form Sections**:

1. **Basisdaten** (Section 1)
   - Age (Input mit NumberPad, 13-120 Jahre)
   - Weight (Input mit DecimalPad, kg)
   - Height (Input mit DecimalPad, cm)
   - Gender (RadioGroup: Male/Female/Other)

2. **Training** (Section 2)
   - Fitness Level (OptionButtons: Beginner/Intermediate/Advanced)
   - Training Experience (Input, Monate)
   - Training Days per Week (NumberPicker: 1-7)
   - Gym Access (Switch: Ja/Nein)
   - Home Equipment (MultiSelectChips, conditional on no gym access)

3. **Trainingsziel** (Section 3)
   - Primary Goal (GoalCards mit Icons):
     - üí™ Kraft aufbauen
     - üèãÔ∏è Muskeln aufbauen
     - üî• Gewicht verlieren
     - üèÉ Ausdauer
     - ‚ú® Allgemeine Fitness

4. **Lifestyle** (Section 4)
   - Sleep Hours (Slider: 3-12h mit 0.5h steps)
   - Stress Level (Slider: 1-10)

5. **Unvertr√§glichkeiten** (Section 5)
   - Checkboxes f√ºr Intolerances aus Katalog
   - Severity Picker (Mild/Moderate/Severe/Life-threatening) per Intolerance
   - L√§dt Katalog via `getIntolerancesCatalog()`

**State Management**:
```typescript
interface ProfileFormData {
  age: number | null;
  weight: number | null;
  height: number | null;
  gender: 'male' | 'female' | 'other' | null;
  fitness_level: 'beginner' | 'intermediate' | 'advanced' | null;
  training_experience_months: number | null;
  available_training_days: number | null;
  has_gym_access: boolean;
  home_equipment: string[];
  primary_goal: 'strength' | 'hypertrophy' | 'endurance' | 'weight_loss' | 'general_fitness' | null;
  sleep_hours_avg: number | null;
  stress_level: number | null;
}

// Separate state for intolerances
const [intolerances, setIntolerances] = useState<UserIntoleranceInput[]>([]);
```

**Input Handling Strategy**:
- **Numeric Fields**: Separate `inputStrings` state preserves comma/period during typing
- **Reason**: Prevents value disappearing when user types "75," for weight
- **Implementation**:
```typescript
const [inputStrings, setInputStrings] = useState({
  age: '',
  weight: '',
  height: '',
  training_experience_months: '',
});

const handleNumericInput = (field, text) => {
  const displayText = text.replace(',', '.');
  setInputStrings(prev => ({ ...prev, [field]: displayText }));
  const numericValue = displayText === '' ? null : parseFloat(displayText) || null;
  updateField(field, numericValue);
};
```

**Validation**:
- Client-side validation via `validateForm()` before save
- Field-level validations:
  - Age: 13-120
  - Weight/Height: > 0
  - Training Days: 1-7
  - Sleep: 3-12 hours
  - Stress: 1-10
- German error messages
- Validation errors displayed in error banner

**Data Flow**:
1. **Load**: `loadProfile()` ‚Üí `getProfile(userId)` + `getUserIntolerances(userId)` ‚Üí Populate `formData`
2. **Edit**: User changes ‚Üí `updateField(field, value)` ‚Üí Updates `formData` state
3. **Save**: `handleSave()` ‚Üí `validateForm()` ‚Üí `updateProfile()` + `saveUserIntolerances()` ‚Üí Navigate back
4. **Cancel**: `handleCancel()` ‚Üí `navigation.goBack()` (no save)

**Loading States**:
- Initial load: ActivityIndicator w√§hrend Profile-Fetch
- Save: Button disabled + loading prop w√§hrend Update
- Success: Green success message + auto-navigation nach 1.5s

**Error Handling**:
- Try-catch in allen async Funktionen
- Deutsche Fehlermeldungen in error banner
- Validation errors vor Supabase-Call
- Network/DB errors angezeigt mit Retry-Option

**UI/UX Features**:
- ‚úÖ Section Headers f√ºr klare Struktur
- ‚úÖ Error/Success Banners (rot/gr√ºn mit farbigem Hintergrund)
- ‚úÖ Disabled states w√§hrend Save
- ‚úÖ Success Message mit Checkmark "Profil erfolgreich gespeichert!"
- ‚úÖ Auto-Navigation zur√ºck zu ProfileScreen nach Success
- ‚úÖ ScrollView f√ºr alle Inhalte (responsive)
- ‚úÖ Consistent Styling mit Onboarding Screens

**Supabase Integration**:
```typescript
// Load profile
const { profile, error } = await getProfile(user.id);

// Update profile
const { error: profileError } = await updateProfile(user.id, formData);

// Update intolerances
const { error: intolerancesError } = await saveUserIntolerances(
  user.id,
  intolerances
);
```

#### ProfileScreen Updates

**Datei**: `src/screens/app/ProfileScreen.tsx`

**Neue Features**:

1. **Edit Button** (Header):
```typescript
<Button
  title="Bearbeiten"
  variant="outline"
  size="small"
  onPress={() => navigation.navigate('ProfileEdit')}
/>
```

2. **Auto-Refresh via useFocusEffect**:
```typescript
import { useFocusEffect } from '@react-navigation/native';

useFocusEffect(
  useCallback(() => {
    loadProfile(); // Reload when screen comes into focus
  }, [])
);
```
- **Zweck**: Zeigt aktualisierte Daten automatisch nach R√ºckkehr von ProfileEdit
- **Trigger**: Jedes Mal wenn ProfileScreen fokussiert wird
- **Benefit**: Keine manuellen Refresh-Buttons n√∂tig

**Navigation Flow**:
```
ProfileScreen
    ‚Üì (Press "Bearbeiten")
ProfileEditScreen
    ‚Üì (Load existing data)
User edits fields
    ‚Üì (Press "Speichern")
Validate ‚Üí Save to Supabase
    ‚Üì (Success)
Navigate back (navigation.goBack())
    ‚Üì
ProfileScreen (useFocusEffect triggers)
    ‚Üì
loadProfile() fetches updated data
    ‚úÖ Display updated profile
```

#### Navigation Integration

**MainNavigator.tsx Updates**:
```typescript
<Stack.Screen
  name="ProfileEdit"
  component={ProfileEditScreen}
  options={{
    title: "Profil bearbeiten",
    headerBackTitle: "Zur√ºck",
  }}
/>
```

**Navigation Types Updates** (`src/navigation/types.ts`):
```typescript
export type MainStackParamList = {
  Home: undefined;
  Profile: undefined;
  ProfileEdit: undefined; // Added 2025-12-27
  Settings: undefined;
};
```

**Type-Safe Navigation**:
```typescript
import type { NativeStackNavigationProp } from '@react-navigation/native-stack';
import type { MainStackParamList } from '../../navigation/types';

type ProfileScreenNavigationProp = NativeStackNavigationProp<
  MainStackParamList,
  'Profile'
>;

const navigation = useNavigation<ProfileScreenNavigationProp>();
navigation.navigate('ProfileEdit'); // Type-safe!
```

**Design-Entscheidungen**:

1. **Single-Page Form vs Tabs**:
   - **Entscheidung**: Single ScrollView mit Sections
   - **Grund**: Einfacher zu implementieren, √ºbersichtlich f√ºr ~15 Felder
   - **Future**: Bei mehr Feldern k√∂nnte Tab-Interface sinnvoll sein

2. **Input String Preservation**:
   - **Problem**: Native Input l√∂scht Wert bei "75," (trailing comma)
   - **L√∂sung**: Separate `inputStrings` state f√ºr Display
   - **Benefit**: Bessere UX beim Tippen von Dezimalzahlen

3. **useFocusEffect vs Manual Refresh**:
   - **Entscheidung**: Automatisches Reload via useFocusEffect
   - **Grund**: Bessere UX, keine Refresh-Button n√∂tig
   - **Trade-off**: Minimaler Performance-Impact (akzeptabel f√ºr Profile Screen)

4. **Validation Strategy**:
   - **Client-Side First**: Schnelles Feedback ohne Network-Call
   - **Server-Side als Backup**: RLS + DB Constraints als Sicherheitsnetz
   - **German Messages**: Alle Fehler in Deutsch f√ºr Zielgruppe

**Reused Components**:
- Input (from `src/components/ui/Input.tsx`)
- Button (from `src/components/ui/Button.tsx`)
- RadioGroup (from `src/components/ui/RadioGroup.tsx`)
- NumberPicker (from `src/components/ui/NumberPicker.tsx`)
- MultiSelectChips (from `src/components/ui/MultiSelectChips.tsx`)
- GoalCard (from `src/components/ui/GoalCard.tsx`)
- Slider (from `src/components/ui/Slider.tsx`)

**Component Consistency**:
- Alle UI Components identisch zu Onboarding Screens
- Consistent COLORS, SPACING, FONT_SIZES
- Identische Validation-Logik
- Gleiche Error-Handling Pattern

### 7. Navigation System (‚úÖ Komplett - 2025-12-26)

**Location**: `src/navigation/`

**Architektur**: Drei-Schicht Navigation (Auth ‚Üí Onboarding ‚Üí Main App)

#### 7.1 AppNavigator (Root Navigator)

**Datei**: `src/navigation/AppNavigator.tsx`

**Zweck**: Root-Level Navigation die zwischen drei Hauptflows routet

**Features**:
- ‚úÖ Authentication State Management via `onAuthStateChange()`
- ‚úÖ Onboarding Completion Check via `isOnboardingCompleted()`
- ‚úÖ Automatic Flow Routing basierend auf User Status:
  - Not authenticated ‚Üí `AuthNavigator`
  - Authenticated + Onboarding incomplete ‚Üí `OnboardingNavigator`
  - Authenticated + Onboarding complete ‚Üí `MainNavigator`
- ‚úÖ Loading State w√§hrend Auth/Onboarding Check
- ‚úÖ Deep Link Configuration f√ºr Email Confirmation & Password Reset
- ‚úÖ NavigationContainer Integration

**State Logic**:
```typescript
// 1. Check auth on mount
useEffect(() => checkAuthAndOnboarding() }, []);

// 2. Listen to auth changes
useEffect(() => {
  const unsubscribe = onAuthStateChange(async (authUser) => {
    setUser(authUser);
    await checkAuthAndOnboarding();
  });
  return () => unsubscribe();
}, []);

// 3. Route to correct navigator
if (!user) return <AuthNavigator />;
if (!hasCompletedOnboarding) return <OnboardingNavigator />;
return <MainNavigator />;
```

**Deep Links**:
- `lifestyleapp://auth/callback` - Email Confirmation
- `lifestyleapp://auth/forgot-password` - Password Reset
- `lifestyleapp://login` - Login Screen
- `lifestyleapp://register` - Register Screen
- `lifestyleapp://home` - Home Screen
- `lifestyleapp://profile` - Profile Screen

**Integration**:
- Importiert in `App.tsx` als Root Component
- Wrapped in `NavigationContainer`
- Services: `auth.service.ts`, `profile.service.ts`

#### 7.2 OnboardingNavigator

**Datei**: `src/navigation/OnboardingNavigator.tsx`

**Zweck**: Managed den 6-Screen Onboarding Flow

**Architektur**:
- State-based Navigation (nicht Stack-based)
- OnboardingContext managed `currentStep` (1-6)
- Switch-Statement rendert passenden Screen basierend auf Step

**Implementation**:
```typescript
<OnboardingProvider>
  <OnboardingScreens />  {/* Renders screen based on currentStep */}
</OnboardingProvider>
```

**Screen Mapping**:
- Step 1 ‚Üí OnboardingScreen1 (Basisdaten)
- Step 2 ‚Üí OnboardingScreen2 (Trainingserfahrung)
- Step 3 ‚Üí OnboardingScreen3 (Fitnessziele)
- Step 4 ‚Üí OnboardingScreen4 (Lifestyle)
- Step 5 ‚Üí OnboardingScreen5 (Unvertr√§glichkeiten)
- Step 6 ‚Üí OnboardingSummary (Submit)

**Navigation Methods**:
- `nextStep()` - N√§chster Screen (mit Validation)
- `previousStep()` - Vorheriger Screen
- `goToStep(n)` - Direkter Sprung zu Screen (f√ºr Edit-Links in Summary)

**Exit Flow**:
- Nach Success in `submitOnboarding()` ‚Üí AppNavigator checkt `isOnboardingCompleted()` ‚Üí Auto-Route zu MainNavigator

#### 7.3 MainNavigator

**Datei**: `src/navigation/MainNavigator.tsx`

**Zweck**: React Navigation Stack f√ºr Main App Screens

**Stack Screens**:
- Home (`src/screens/app/HomeScreen.tsx`) - Dashboard/Landing
- Profile (`src/screens/app/ProfileScreen.tsx`) - User Profile Display (Read-only with Edit button)
- ProfileEdit (`src/screens/app/ProfileEditScreen.tsx`) - Profile Editing Form (2025-12-27)

**Configuration**:
```typescript
<Stack.Navigator
  screenOptions={{
    headerShown: true,
    animation: "slide_from_right",
  }}
  initialRouteName="Home"
>
```

**Features**:
- ‚úÖ Native Stack Navigator (performanter als Stack)
- ‚úÖ iOS Large Title Support
- ‚úÖ Slide Animation
- ‚úÖ Header shown by default
- ‚úÖ Profile Edit Flow with automatic data refresh (2025-12-27)

**Future Screens** (geplant):
- Training
- Nutrition
- Progress/Stats
- Settings

#### 7.4 Navigation Types

**Datei**: `src/navigation/types.ts`

**TypeScript Param Lists f√ºr Type-Safe Navigation**:

```typescript
// Auth Flow
export type AuthStackParamList = {
  Login: undefined;
  Register: undefined;
  ForgotPassword: undefined;
  Welcome: undefined;
  AuthCallback: undefined;
};

// Onboarding Flow (State-based, keine Params)
export type OnboardingStackParamList = {
  OnboardingStep1: undefined;
  OnboardingStep2: undefined;
  OnboardingStep3: undefined;
  OnboardingStep4: undefined;
  OnboardingStep5: undefined;
  OnboardingSummary: undefined;
};

// Main App Flow
export type MainStackParamList = {
  Home: undefined;
  Profile: undefined;
  ProfileEdit: undefined;  // Added 2025-12-27
  Settings: undefined;
};

// Root Level
export type RootStackParamList = {
  Auth: undefined;
  App: undefined;
};
```

**Usage in Screens**:
```typescript
import { NativeStackScreenProps } from '@react-navigation/native-stack';
import { MainStackParamList } from '@/navigation/types';

type HomeScreenProps = NativeStackScreenProps<MainStackParamList, 'Home'>;

const HomeScreen: React.FC<HomeScreenProps> = ({ navigation }) => {
  navigation.navigate('Profile'); // Type-safe!
};
```

#### 7.5 Navigation Exports

**Datei**: `src/navigation/index.ts`

**Zentrale Exports**:
```typescript
export { AppNavigator } from './AppNavigator';
export { OnboardingNavigator } from './OnboardingNavigator';
export { MainNavigator } from './MainNavigator';
export * from './types';
```

**Usage**:
```typescript
import { AppNavigator } from '@/navigation';
// oder
import { MainStackParamList } from '@/navigation';
```

#### Navigation Flow Diagram

```
App Start
    ‚Üì
AppNavigator (Root)
    ‚îú‚îÄ getCurrentUser()
    ‚îú‚îÄ isOnboardingCompleted()
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Not Authenticated‚îÇ Auth + No Onboarding‚îÇ Auth + Onboarding‚îÇ
‚îÇ                  ‚îÇ                     ‚îÇ                  ‚îÇ
‚Üì                  ‚Üì                     ‚Üì
AuthNavigator      OnboardingNavigator   MainNavigator
(Login, Register)  (6 Screens)          (Home, Profile)
    ‚Üì                     ‚Üì
Sign In/Up         submitOnboarding()
    ‚Üì                     ‚Üì
OnboardingNavigator  ‚Üí MainNavigator
```

**Design-Entscheidung**: State-Based Onboarding statt Stack
- **Warum**: Bessere UX f√ºr Multi-Step Forms (keine Back-Stack Confusion)
- **Wie**: OnboardingContext managed `currentStep`, Navigator rendert Screen via Switch
- **Vorteil**: `goToStep()` erlaubt direkten Sprung (z.B. Edit-Links in Summary)
- **Trade-off**: Kein nativer Back-Button Support (muss `previousStep()` nutzen)

## Aktuelle Phase: MVP

**Abgeschlossen**:
- ‚úÖ Authentication Service
- ‚úÖ Form Validation System
- ‚úÖ UI Components (13 Components - 2025-12-26)
- ‚úÖ Testing Setup
- ‚úÖ Profile Service (2025-12-26)
- ‚úÖ Onboarding Context (2025-12-26)
- ‚úÖ Onboarding Screens (6 Screens + Summary - 2025-12-26)
- ‚úÖ **Navigation System** (2025-12-26):
  - ‚úÖ AppNavigator (Root with Auth/Onboarding/Main routing)
  - ‚úÖ OnboardingNavigator (State-based 6-screen flow)
  - ‚úÖ MainNavigator (Home/Profile stack)
  - ‚úÖ Navigation Types (TypeScript param lists)
- ‚úÖ Main App Screens (Home, Profile - 2025-12-26)
- ‚úÖ **Profile Edit System** (2025-12-27):
  - ‚úÖ ProfileEditScreen (Comprehensive edit form)
  - ‚úÖ ProfileScreen integration (Edit button + auto-refresh)
  - ‚úÖ Navigation updates (ProfileEdit route)

**In Arbeit** (Branch: `feature/profile-edit`):
- üîÑ Login & Registrierung Screens
- üîÑ AuthNavigator Implementation
- üîÑ App.tsx Integration & Testing

**N√§chste Schritte**:
- ‚è∏Ô∏è Auth Screens fertigstellen (Login, Register, ForgotPassword)
- ‚è∏Ô∏è Trainingsplan-Generator
- ‚è∏Ô∏è Workout Tracking
- ‚è∏Ô∏è Nutrition Tracking

## Architektur-Entscheidungen

### 1. Validation ohne externe Library
**Entscheidung**: Custom validation in `src/utils/validation.ts` statt Zod/Yup
**Grund**: Kleinerer Bundle, volle Kontrolle, ausreichend f√ºr MVP
**Impact**: 59 Tests, alle Validation-Regeln selbst definiert

### 2. Testing Setup ohne Framework
**Entscheidung**: `tsx` + console assertions statt Jest/Vitest
**Grund**: Schneller Setup, weniger Dependencies f√ºr MVP
**Future**: Migration zu Jest empfohlen wenn Projekt w√§chst

### 3. Supabase AsyncStorage Integration
**Entscheidung**: AsyncStorage f√ºr Session persistence
**Grund**: Native persistence, keine zus√§tzlichen Cookies n√∂tig
**Implementation**: In `src/lib/supabase.ts` konfiguriert

### 4. Deutsche Error Messages
**Entscheidung**: Alle Fehler in Deutsch
**Grund**: Zielgruppe ist deutsch
**Future**: i18n-Support wenn internationale Expansion geplant

### 5. Service Layer Pattern
**Entscheidung**: Separate `services/` f√ºr Business Logic
**Grund**: Trennung von UI und Logik, bessere Testbarkeit
**Example**: `auth.service.ts` kann ohne UI getestet werden
**Update 2025-12-26**: `profile.service.ts` f√ºr Onboarding-Daten hinzugef√ºgt

### 6. Context + Reducer f√ºr Multi-Step Forms
**Entscheidung**: React Context + useReducer f√ºr Onboarding-Flow
**Grund**:
- Zentraler State √ºber 6 Screens
- Validation vor Screen-Wechsel
- Einfaches Progress-Tracking
- Kein Redux f√ºr MVP n√∂tig
**Implementation**: `OnboardingContext.tsx` mit 7 Actions
**Alternative erwogen**: Zustand Library (zu viel f√ºr MVP)
**Future**: Bei mehr komplexen Flows k√∂nnte Zustand sinnvoll sein

### 7. Component-Based UI ohne externe UI Library
**Entscheidung**: Eigene UI Components in `src/components/ui/` statt Library (NativeBase, React Native Paper, etc.)
**Grund**:
- Volle Design-Kontrolle
- Kleinerer Bundle Size
- Keine Breaking Changes durch Library Updates
- Native Performance (kein Web-Bridge)
- Einfach zu customizen f√ºr spezifische Use Cases
**Implementation**: 13 Components mit consistentem Design System
**Trade-off**: Mehr Entwicklungszeit initial, aber langfristig flexibler
**Future**: Bei sehr komplexen Components k√∂nnte Headless UI (z.B. React Native ARIA) sinnvoll sein

### 8. Multi-Step Onboarding Pattern
**Entscheidung**: 6 separate Screens statt Single-Page Form
**Grund**:
- Bessere UX auf Mobile (weniger overwhelming)
- Klare Progress-Indication (ProgressBar)
- Screen-spezifische Validation m√∂glich
- Einfacher zu navigieren (zur√ºck zu einzelnem Screen)
- Kleinere Code-Dateien pro Screen
**Implementation**:
- Jeder Screen ist eigenst√§ndige Component
- OnboardingContext managed State zentral
- `goToStep()` f√ºr direkte Navigation (z.B. von Summary zur√ºck)
**Data Flow**: User Input ‚Üí updateData() ‚Üí nextStep() validiert ‚Üí Success: Wechsel ‚Üí Summary: submitOnboarding() ‚Üí Supabase
**Alternative erwogen**: Wizard Component mit Steps (zu eingeschr√§nkt f√ºr komplexe Flows)

### 9. Three-Tier Navigation Architecture
**Entscheidung**: Drei separate Navigator-Schichten (Auth, Onboarding, Main) mit Root-Level Routing
**Grund**:
- **Klare Trennung**: Jeder Flow hat eigenen Navigator mit eigener Logik
- **Zustandsbasierte Navigation**: Root Navigator entscheidet basierend auf Auth + Onboarding Status
- **Einfache Flow-Kontrolle**: Ein Check in AppNavigator routet zu korrektem Flow
- **Bessere Performance**: Nur ben√∂tigte Screens werden geladen
- **Type Safety**: Separate ParamLists f√ºr jeden Flow
**Implementation**:
- `AppNavigator`: Root mit conditionalem Rendering (`!user` ‚Üí Auth, `!onboarding` ‚Üí Onboarding, else ‚Üí Main)
- `OnboardingNavigator`: State-based (Context `currentStep`) statt Stack
- `MainNavigator`: Standard React Navigation Stack
**Alternative erwogen**: Single Stack mit Conditional Screens (zu komplex, schlechtere Type Safety)
**Trade-off**: Mehr Boilerplate initial, aber langfristig wartbarer

### 10. State-Based vs Stack-Based Navigation f√ºr Onboarding
**Entscheidung**: State-Based Navigation (OnboardingContext `currentStep`) f√ºr Onboarding
**Grund**:
- **UX**: Kein Back-Stack der User verwirrt (nicht zur√ºck au√üerhalb von Onboarding)
- **Progress Control**: `goToStep(n)` erlaubt direkten Sprung (Edit-Links in Summary)
- **Validation Flow**: Screen-Wechsel nur via `nextStep()` mit Validation-Gate
- **State Persistence**: Context h√§lt alle Daten zentral (kein Param-Passing zwischen Screens)
**Implementation**:
```typescript
// OnboardingNavigator.tsx
const OnboardingScreens = () => {
  const { currentStep } = useOnboarding();
  switch (currentStep) {
    case 1: return <OnboardingScreen1 />;
    case 2: return <OnboardingScreen2 />;
    // ...
  }
};
```
**Alternative erwogen**: Stack Navigator mit 6 Screens (komplexere Back-Handling, kein direkter Step-Jump)
**Trade-off**: Kein nativer Back-Button Support (Android), muss `previousStep()` Button in UI haben

### 11. Profile Edit with Input String Preservation (2025-12-27)
**Entscheidung**: Separate `inputStrings` state f√ºr numeric inputs zus√§tzlich zu parsed values
**Problem**: React Native TextInput l√∂scht Value bei trailing comma/period (z.B. "75," wird zu "")
**Grund**:
- Bessere UX beim Tippen von Dezimalzahlen
- User kann "75," tippen ohne dass Wert verschwindet
- Comma wird automatisch zu Period konvertiert
**Implementation**:
```typescript
const [formData, setFormData] = useState({ weight: null });
const [inputStrings, setInputStrings] = useState({ weight: '' });

const handleNumericInput = (field, text) => {
  const displayText = text.replace(',', '.');
  setInputStrings(prev => ({ ...prev, [field]: displayText }));
  const numericValue = parseFloat(displayText) || null;
  updateField(field, numericValue);
};
```
**Trade-off**: Mehr State-Management, aber deutlich bessere User Experience

### 12. useFocusEffect f√ºr Auto-Refresh (2025-12-27)
**Entscheidung**: useFocusEffect Hook statt manueller Refresh-Button in ProfileScreen
**Grund**:
- Automatisches Reload der Profil-Daten nach R√ºckkehr von ProfileEdit
- Bessere UX (keine manuellen Actions n√∂tig)
- Stellt sicher dass User immer aktuelle Daten sieht
**Implementation**:
```typescript
import { useFocusEffect } from '@react-navigation/native';

useFocusEffect(
  useCallback(() => {
    loadProfile();
  }, [])
);
```
**Alternative erwogen**: Navigation Parameter zum Trigger Reload (komplizierter, weniger elegant)
**Trade-off**: Minimaler Performance-Impact bei jedem Focus (akzeptabel f√ºr Profile Screen)

## Coding Standards

- TypeScript strict mode
- Functional components + Hooks (keine Classes)
- Async/await (keine Promises.then)
- Descriptive variable names (deutsch ok)
- Error handling √ºberall
- Comments nur wenn n√∂tig
- Alle Dateien mit absoluten Pfaden referenzieren in Dokumentation

## Testing Infrastructure

**Setup**:
- `tsx` f√ºr TypeScript execution (kein Jest/Vitest)
- `dotenv` f√ºr Environment variables
- Simple console-based assertions

**Test Commands**:
```bash
npm run test:auth:simple    # Authentication service tests
npm run test:validation     # Validation tests (59 tests, all passing)
```

**Test Files**:
- `src/tests/auth.test.simple.ts` - Auth service functions
- `src/tests/validation.test.ts` - Alle Validation utilities

**Manual Testing**:
- iOS Simulator / Android Emulator
- Nach jedem Screen testen
- Validierung testen (leere Felder, wrong format)

## Git Workflow

- `main` = stable
- Feature branches: `features/feature-name` (aktuell: `features/ui`)
- Pull bevor du arbeitest
- Kleine, h√§ufige Commits

## Supabase Access

Via MCP Server - direkte DB-Zugriffe m√∂glich.
